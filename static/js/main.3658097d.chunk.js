(this.webpackJsonpwebrtc=this.webpackJsonpwebrtc||[]).push([[0],[,,,,,,,,function(e,t,s){},function(e,t,s){},function(e,t,s){},,function(e,t,s){},function(e,t,s){},function(e,t,s){"use strict";s.r(t);var c=s(1),n=s.n(c),i=s(3),a=s.n(i),r=(s(8),s(9),s(10),s(0));function o({onChangeDevice:e}){const[t,s]=Object(c.useState)([]),[n,i]=Object(c.useState)([]),[a,o]=Object(c.useState)([]),l=Object(c.useRef)(null),d=Object(c.useRef)(null),u=Object(c.useRef)(null);Object(c.useEffect)((()=>{navigator.mediaDevices.enumerateDevices().then((e=>{e.forEach((e=>{switch(e.kind){case"videoinput":s((t=>[...t,e]));break;case"audioinput":i((t=>[...t,e]));break;case"audiooutput":o((t=>[...t,e]));break;default:console.log(`unknow device: ${e.kind}`)}}))})).catch((e=>{throw console.error(e),e}))}),[]);const j=()=>{const s=(()=>{var e,s,c,i,r,o;return{videoinput:t[null!==(e=null===(s=l.current)||void 0===s?void 0:s.selectedIndex)&&void 0!==e?e:0],audioinput:n[null!==(c=null===(i=d.current)||void 0===i?void 0:i.selectedIndex)&&void 0!==c?c:0],audiooutput:a[null!==(r=null===(o=u.current)||void 0===o?void 0:o.selectedIndex)&&void 0!==r?r:0]}})();e(s)};return Object(r.jsx)("div",{children:[{title:"\u6444\u50cf\u5934",devices:t,ref:l},{title:"\u9ea6\u514b\u98ce",devices:n,ref:d}].map((({title:e,devices:t,ref:s})=>Object(r.jsxs)("label",{children:[e,":",Object(r.jsx)("select",{onChange:j,ref:s,children:t.map((e=>Object(r.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId)))})]},e)))})}s(12);function l({stream:e}){let t,s=[];const n=Object(c.useRef)(null),i={start(){t=new MediaRecorder(e),t.start(),t.ondataavailable=e=>s.push(e.data),t.onstop=e=>{const t=new Blob(s);n.current&&(n.current.src=URL.createObjectURL(t))}},stop(){t.stop()},pause(){t.pause()},resume(){t.resume()},delete(){s=[]}};return Object(r.jsxs)("div",{children:[Object(r.jsxs)("section",{className:"operation",onClick:function(e){const{className:t}=e.target;t in i&&i[t]()},children:[Object(r.jsx)("button",{className:"start",children:"\u5f00\u59cb"}),Object(r.jsx)("button",{className:"stop",children:"\u505c\u6b62"}),Object(r.jsx)("button",{className:"pause",children:"\u6682\u505c"}),Object(r.jsx)("button",{className:"resume",children:"\u7ee7\u7eed"}),Object(r.jsx)("button",{className:"delete",children:"\u5220\u9664"})]}),Object(r.jsx)("section",{className:"playvideo",children:Object(r.jsx)("video",{ref:n,controls:!0})})]})}s(13);class d{constructor(e,t){this.constraints={audio:!0,video:!0},this.stream=void 0,this.videoRef=void 0,this.constraints=null!==e&&void 0!==e?e:this.constraints,this.stream=null,this.videoRef=t}setVideoRef(e){this.videoRef=e}async getMedia(){this.stream=await navigator.mediaDevices.getUserMedia(this.constraints).catch((e=>{throw console.error(e),e})),this.displayInHtml()}getStream(){return this.stream}async startCamera(){await this.getMedia()}async startScreen(){this.stream=await navigator.mediaDevices.getDisplayMedia(this.constraints).catch((e=>{throw console.error(e),e})),this.displayInHtml()}displayInHtml(){var e;(null===(e=this.videoRef)||void 0===e?void 0:e.current)&&(this.videoRef.current.srcObject=this.stream)}takeSnap(e){if(!this.stream)return;new ImageCapture(this.stream.getVideoTracks()[0]).grabFrame().then((t=>{const s=e.current;if(null!==s){const e=s.getContext("2d");let c,n;{const{width:e,height:t}=getComputedStyle(s);c=Number(e.split("px")[0]),n=Number(t.split("px")[0])}e&&e.clearRect(0,0,c,n),e&&e.drawImage(t,0,0,c,n)}}))}changeDevices(e){this.close(),this.constraints=e,this.getMedia()}close(){var e;console.log(this.stream),null===(e=this.stream)||void 0===e||e.getTracks().forEach((e=>{var t;e.stop(),null===(t=this.stream)||void 0===t||t.removeTrack(e),console.log(`remove ${e.kind}`)}))}}function u(){const e=Object(c.useRef)(null),t=Object(c.useRef)(null),[s]=Object(c.useState)(new d({audio:!1,video:!0},e)),[n,i]=Object(c.useState)(s.getStream());async function a(e){switch(e){case"camera":await s.startCamera();break;case"screen":await s.startScreen()}i(s.getStream())}return Object(r.jsxs)("div",{children:[Object(r.jsx)(o,{onChangeDevice:({videoinput:e,audioinput:t})=>{console.log(e),s.changeDevices({video:{deviceId:e.deviceId},audio:{deviceId:t.deviceId}})}}),Object(r.jsxs)("section",{children:[Object(r.jsxs)("section",{children:[Object(r.jsx)("div",{children:"\u6211\u7684\u89c6\u9891"}),Object(r.jsx)("video",{className:"myvideo",src:"#",autoPlay:!0,ref:e})]}),Object(r.jsxs)("section",{children:[Object(r.jsx)("div",{children:"\u5bf9\u65b9\u89c6\u9891"}),Object(r.jsx)("video",{className:"othervideo",src:"#",autoPlay:!0})]}),Object(r.jsxs)("section",{children:[Object(r.jsx)("div",{children:"\u753b\u5e03"}),Object(r.jsx)("canvas",{className:"canvas",ref:t})]})]}),Object(r.jsxs)("section",{children:[Object(r.jsx)("button",{onClick:()=>a("camera"),children:"\u6355\u6349\u5a92\u4f53"}),Object(r.jsx)("button",{onClick:()=>s.takeSnap(t),children:"\u62cd\u7167"}),Object(r.jsx)("button",{onClick:()=>a("screen"),children:"\u5206\u4eab\u5c4f\u5e55"}),Object(r.jsx)("button",{onClick:()=>s.close(),children:"\u5173\u95ed"})]}),null!==n&&Object(r.jsx)(l,{stream:n})]})}var j=function(){return Object(r.jsx)("div",{className:"App",children:Object(r.jsx)(u,{})})};var h=e=>{e&&e instanceof Function&&s.e(3).then(s.bind(null,15)).then((({getCLS:t,getFID:s,getFCP:c,getLCP:n,getTTFB:i})=>{t(e),s(e),c(e),n(e),i(e)}))};a.a.render(Object(r.jsx)(n.a.StrictMode,{children:Object(r.jsx)(j,{})}),document.getElementById("root")),h()}],[[14,1,2]]]);
//# sourceMappingURL=main.3658097d.chunk.js.map