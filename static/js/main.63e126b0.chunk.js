(this.webpackJsonpwebrtc=this.webpackJsonpwebrtc||[]).push([[0],[,,,,,,,,function(e,t,i){},function(e,t,i){},function(e,t,i){},,function(e,t,i){},function(e,t,i){"use strict";i.r(t);var c=i(1),s=i.n(c),n=i(3),a=i.n(n),r=(i(8),i(9),i(10),i(0));function o({onChangeDevice:e}){const[t,i]=Object(c.useState)([]),[s,n]=Object(c.useState)([]),[a,o]=Object(c.useState)([]),d=Object(c.useRef)(null),l=Object(c.useRef)(null),u=Object(c.useRef)(null);Object(c.useEffect)((()=>{navigator.mediaDevices.enumerateDevices().then((e=>{e.forEach((e=>{switch(e.kind){case"videoinput":i((t=>[...t,e]));break;case"audioinput":n((t=>[...t,e]));break;case"audiooutput":o((t=>[...t,e]));break;default:console.log(`unknow device: ${e.kind}`)}}))})).catch((e=>{throw console.error(e),e}))}),[]);const v=()=>{const i=(()=>{var e,i,c,n,r,o;return{videoinput:t[null!==(e=null===(i=d.current)||void 0===i?void 0:i.selectedIndex)&&void 0!==e?e:0],audioinput:s[null!==(c=null===(n=l.current)||void 0===n?void 0:n.selectedIndex)&&void 0!==c?c:0],audiooutput:a[null!==(r=null===(o=u.current)||void 0===o?void 0:o.selectedIndex)&&void 0!==r?r:0]}})();e(i)};return Object(r.jsx)("div",{children:[{title:"\u6444\u50cf\u5934",devices:t,ref:d},{title:"\u9ea6\u514b\u98ce",devices:s,ref:l}].map((({title:e,devices:t,ref:i})=>Object(r.jsxs)("label",{children:[e,":",Object(r.jsx)("select",{onChange:v,ref:i,children:t.map((e=>Object(r.jsx)("option",{value:e.deviceId,children:e.label},e.deviceId)))})]},e)))})}i(12);class d{constructor(e,t){this.constraints={audio:!0,video:!0},this.stream=void 0,this.videoRef=void 0,this.constraints=null!==e&&void 0!==e?e:this.constraints,this.stream=null,this.videoRef=t}setVideoRef(e){this.videoRef=e}async getMedia(){this.stream=await navigator.mediaDevices.getUserMedia(this.constraints).catch((e=>{throw console.error(e),e})),this.displayInHtml()}async startCamera(){await this.getMedia()}async startScreen(){this.stream=await navigator.mediaDevices.getDisplayMedia(this.constraints).catch((e=>{throw console.error(e),e})),this.displayInHtml()}displayInHtml(){var e;(null===(e=this.videoRef)||void 0===e?void 0:e.current)&&(this.videoRef.current.srcObject=this.stream)}takeSnap(e){if(!this.stream)return;new ImageCapture(this.stream.getVideoTracks()[0]).grabFrame().then((t=>{const i=e.current;if(null!==i){const e=i.getContext("2d");let c,s;{const{width:e,height:t}=getComputedStyle(i);c=Number(e.split("px")[0]),s=Number(t.split("px")[0])}e&&e.clearRect(0,0,c,s),e&&e.drawImage(t,0,0,c,s)}}))}changeDevices(e){var t;this.constraints=e,null===(t=this.stream)||void 0===t||t.getTracks().forEach((e=>{var t;null===(t=this.stream)||void 0===t||t.removeTrack(e)})),this.getMedia()}}function l(){const e=Object(c.useRef)(null),t=Object(c.useRef)(null),i=new d({audio:!1,video:!0},e);return Object(r.jsxs)("div",{children:[Object(r.jsx)(o,{onChangeDevice:({videoinput:e,audioinput:t})=>{console.log(e),i.changeDevices({video:{deviceId:e.deviceId},audio:{deviceId:t.deviceId}})}}),Object(r.jsxs)("section",{children:[Object(r.jsxs)("section",{children:[Object(r.jsx)("div",{children:"\u6211\u7684\u89c6\u9891"}),Object(r.jsx)("video",{className:"myvideo",src:"#",autoPlay:!0,ref:e})]}),Object(r.jsxs)("section",{children:[Object(r.jsx)("div",{children:"\u5bf9\u65b9\u89c6\u9891"}),Object(r.jsx)("video",{className:"othervideo",src:"#",autoPlay:!0})]}),Object(r.jsxs)("section",{children:[Object(r.jsx)("div",{children:"\u753b\u5e03"}),Object(r.jsx)("canvas",{className:"canvas",ref:t})]})]}),Object(r.jsxs)("section",{children:[Object(r.jsx)("button",{onClick:()=>i.startCamera(),children:"\u6355\u6349\u5a92\u4f53"}),Object(r.jsx)("button",{onClick:()=>i.takeSnap(t),children:"\u62cd\u7167"}),Object(r.jsx)("button",{onClick:()=>i.startScreen(),children:"\u5206\u4eab\u5c4f\u5e55"})]})]})}var u=function(){return Object(r.jsx)("div",{className:"App",children:Object(r.jsx)(l,{})})};var v=e=>{e&&e instanceof Function&&i.e(3).then(i.bind(null,14)).then((({getCLS:t,getFID:i,getFCP:c,getLCP:s,getTTFB:n})=>{t(e),i(e),c(e),s(e),n(e)}))};a.a.render(Object(r.jsx)(s.a.StrictMode,{children:Object(r.jsx)(u,{})}),document.getElementById("root")),v()}],[[13,1,2]]]);
//# sourceMappingURL=main.63e126b0.chunk.js.map